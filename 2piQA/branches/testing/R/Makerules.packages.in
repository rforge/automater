# For use in the packages dirs
PAC=$(notdir $(shell pwd ))

# Next is to set pkg-version file timestamp to the same value on all
#  test farm servers, since svn update does not preserve the timestamp.
# The first server to run with a package version should recognize this and
#  do the commit to update the $(PAC)-version file.

.PHONY: $(PAC)-version

# packageDescription is faster than installed.packages

availablePKG=${shell echo 'packageVersion("$(PAC)")' | R --slave }
committedPKG=${shell head -1 $(PAC)-version }
PKGdate=${shell tail -1 $(PAC)-version }

#  THIS IS ASSUMING DIFFERENT VERSION IS NEWER VERSION!!!!
$(PAC)-version:
	@svn update
	@if [ '$(committedPKG)' = '$(availablePKG)' ]; then \
	    touch --date "$(PKGdate)"  $@ ;\
 	  else \
 	    echo changed $(PAC) version ;\
 	    echo '$(availablePKG)'           >$@ ;\
 	    date "+%Y/%m/%d %H:%M:%S.%N %Z" >>$@ ;\
	    svn commit $@ -m '$@n updated to $(availablePKG).' ;\
 	  fi


# this Makevars file is not use in the package directory,  it is used in the
#  upper level dir to filter the list of snippets. 
Makevars: $(PAC)-version
	echo "#auto-generated by make from package DESCRIPTION" >$@
	#echo "RESOURCE-REQUIREMENTS="	 >>$@
	#echo "OS-RESTRICTIONS="         >>$@

